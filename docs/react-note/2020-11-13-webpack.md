---
order: 4
title: webpack
group:
    title: webpack
    order: 1
---

# 零配置
```
npm init -y
```
初始化package.json


不将webpack安装到全局，局部项目中打包，用：
```
npx webpack
```
这会去找node_modules/.bin /webpack，内部调用webpack-cli命令。


后半部分呢配置在package.json中，就可以变成脚本使用。如：
```
npm run dev
```
# 文件指纹

三种：**hash chunkHash contentHash**如：
```
'bundle.[contentHash:8].js'
```
如果在`HtmlWebpackPlugin`中加`hash: true`，就会自动加hash。

# log

```
node "/user/webpack.config.js"
```
可以打印出，配置文件中的`console.log`

不要去掉`path.resolve`直接写`__dirname`，`path.resolve(__dirname,'dist')`才是绝对地址。

# clean-webpack-plugin
```
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

······

plugins: [
    new CleanWebpackPlugin()
]
```
>先删除打包文件，再打包。

# 如何实现自动化打包

>weboack-dev-server 创建本地服务器 自动重新构建 (打开浏览器，刷新)
```
devServer: {// 在（浏览器）内存中打包 所有的内容在根目录下
    port: 777,
    open: true,
    compress: trus,
    contentBase: 'static',// 启动配置访问一个静态资源文件
    hot: true
}
```

# 多入口文件

```
entry: {
    index: './src/index.html',
    other: './src/other.html'
}

output: {
    filename: '[name].js',
    path: path.resolve(__dirname,"dist")
}
```
然后有多少个入口文件，new多少个：
```
new HtmlWebpackPlugin({
    template: "./other.html",
    hash: true,
    filename: "other.html",
    chunks:['other'],
    minify: { // 打包后的文件 去掉一点儿东西
        removeAttributeQuotes: true, // 比如删除引号
        collapseWhitespace: true // 删除空格
    }
})
```
数量大怎么处理：
```
let htmlPlugin = ['index','other'].map(chunkName => {
    return new HtmlWebpackPlugin({
        template: `./${other}.html`,
        hash: true,
        filename: `${chunkName}.html`,
        chunks:[chunkName],
        minify: { // 打包后的文件 去掉一点儿东西
            removeAttributeQuotes: true, // 比如删除引号
            collapseWhitespace: true // 删除空格
        }
    })
})
```
然后再plugin处解构：
```
...htmlPlugin
```
# 样式配置（前缀、抽离、压缩）
 style-loader css-loader  
 less less-loader  
 node-sass sass-loader  
 styleus styleus-loader  

```
module:{
    rules:[// 执行顺序从下往上 从右往左
        {
            use: ['style-loader','css-loader']// {需要设置更多的参数} '只有一个loader' []
            enforce: 'post'// pre优先加载 post最后加载
        }, {
            use: ['postcss-loader']
        }
    ]
}
```

### 前缀
postcss-loader   （私有前缀插件）
(样式处理工具) autoprefixer
```
postcss.config.js// 自己有一个配置文件
// 设置处理样式的配置文件
module.exports = {
    plugins: [
        require('autoprefixer')
    ]
}
```

```
webpack.config.js

{
    test: /\.css$/,
    use: ['styled-loader',
    {
        loader: MiniCssExtractPlugin.loader
    },
    {
        loader: 'css-loader',
        options: {
            importLoader: 2 // 用后面一个加载器来解析
        }
    },'postcss-loader','less-loader'
    ]
}
```
当浏览器版本高，加的前缀不会很全，所以加上下面的文件，扩大**浏览器适配范围**，css3中各种前缀，适配各种浏览器。
```
.browserslistrc
cover 99.99%
```

### 抽离
分离css插件：mini-css-extract-plugin
```
new MiniCssExtractPlugin({
    filename: 'css/main.css' // 设置分离出的css文件名和目录
})
```

加上这个时候，style-loader就不需要了
``` 
{
        test: /\.css$/,
        use: [
          {
            loader: MiniCssExtractPlugin.loader,
            options: {
              // 这里可以指定一个 publicPath
              // 默认使用 webpackOptions.output中的publicPath
              publicPath: '../'
            },
          },
          'css-loader',
        ],
      }
```

### 压缩
optimize-css-assets-webpack-plugin // css
terser-webpack-plugin // js
```
optimization: {
    minimizer: [// 压缩css js
        new OptimizeCssAssetsWebpackPlugin()
    ]
}
```

# 图片处理及字体图标
```
{
    test: /\.(jpg|png|jpeg|gif))$/,
    use: {
        loader: 'file-loader',
        options: { // 保留原名
            name: 'img/[name].[ext]'
        }
    }
}
```

压缩
```
{
    test: /\.(jpg|png|jpeg|gif))$/,
    use: {
        loader: 'url-loader',
        options: { // 小于100kb，base64输出。大于100kb，调用file-loader，打包成文件输出
            limit: 10 * 1024,
            <!-- outputPath: 'img', 输出目录 -->
            <!-- publicPath: 'http://zhufengpei.xun' -->
        }
    }
}
```

iconfont 使用：

生成必要的地址后，可以直接使用URL地址，也可以下载到本地。

webpack.config.js
```
{
    test: /\.(eot|woff|woff2|svg|ttf)$/,
    use: 'file-loader'
}
```

取css :before 前面的那个class名：
```
import url from './imgPath.png';

let oImg = new Image();
oImg.src = url;
document.body.appendChild(oImg);

let i = document.createElement('i');
i.className = 'iconfont icon-caidan';
document.body.appendChild('i');
```

# 编译 Babel

```
@babel/core        babel的核心模块
babel-loader       解析js代码 webpack与babel的桥梁
@babel/preset-env  预设：es6转es5插件集合（箭头函数）


{
    test: /\.js$/,
    use: "babel-loader",
    include: path.resolve(__dirname,'src'),
    exclude: /node_modules/ 
}
```

#### ·babelrc
```
{
    "presets": [
        // 编译箭头函数
        "@babel/preset-env",{
            <!-- 更高级的编译 -->
            "useBuiltIns": "useage" // 只转换使用的api
            "corejs": 3 // 转换es6中高版本的API
        } 
    ],// 预设（插件的集合）从下往上

    "plugins": [] // 一个个插件 从上往下
}
```

#### 草案 如装饰器、修饰符  
[@babel/plugin-proposal-class-properties](https://babeljs.io/docs/en/babel-plugin-proposal-class-properties)  
[@babel/plugin-proposal-decorators](https://babeljs.io/docs/en/babel-plugin-proposal-decorators)  

```
{
  "plugins": ["@babel/plugin-proposal-decorators"]
}
```
```
{
  "plugins": [
    ["@babel/plugin-proposal-decorators", { "legacy": true }],
    ["@babel/plugin-proposal-class-properties", { "loose" : true }]
  ]
}
```

```
@fn
class Son {

}

function fn(target){
    target.flag = true;
}

Son.flag
```

可以装饰类的属性
```
class Perons {
    @readonly
    first = 1
}

function readonly(target, name, descriptor) {
    descriptor.writable = false;// 不可更改
}

```
##### 优化

[@babel/plugin-transform-runtime 依赖于runtime](https://babeljs.io/docs/en/babel-plugin-transform-runtime#docsNav)  
[@babel/runtime](https://babeljs.io/docs/en/babel-runtime-corejs2)  

```
"plugins": [
    "@babel/plugin-transform-runtime",
    // 它依赖于runtime，所以就写它一个就好，因为它自己会去找runtime

]
```
# 兼容IE 

[找不到标识符-default](https://github.com/zuojj/fedlab/issues/5)  
[Is your Vue app not working in IE 11? Here’s how to fix it.](https://jacklyons.me/how-to-fix-vuejs-not-working-in-ie11/#how-to-transpile-your-vue-code)  
[vue cli](https://cli.vuejs.org/config/#runtimecompiler)  
[core-js](https://www.cnblogs.com/sefaultment/p/11631314.html)  

>IE浏览器有一个兼容性配置，将不兼容的网站，存入

