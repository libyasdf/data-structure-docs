---
order: 11
title: 闭包作用域 JS高阶编程技巧
group:
    title: JS
    order: 1
---

#### 例题2
* 10+(++i)先算++i,累加后的值和10运算
* 10+(i++)先10+i,运算后在让i累加1

[关系图](20201206/3.png)   

```
let x = 5;
function fn(x) {
    return function(y) {
        console.log(y + (++x));
    }
}
let f = fn(6);
f(7);
fn(8)(9);
f(10);
console.log(x);
```

1. f关联着0x0002的heap，所以heap无法释放。而创建出0x0002heap的FN1也无法被释放，闭包产生了。

1. GC浏览器垃圾回收机制「内存管理机制」
+ 引用标记「谷歌」（浏览器在空闲，把所有没有被占用的释放掉）
+ 引用计数「IE低版本」

### 内存泄漏
总结: 当前内存一-但被占用，则不能被释放。如果没有被占用，则浏览器空闲期会释放掉他们。

### Heap堆内存释放
方式：
```
let obj={xx: xxx'};
obj = null;// 空对象指针
```

### Stack栈内存释放
+ 全局上下文: 加载页面形成、关闭页面释放（无法人为干涉）
+ 私有上下文:
  + 默认函数执行完，形成的上下文都会被出栈释放
  + 特殊:如果当前上下文中的某些内容(一般指一个堆)，被上下文以外的内容所占用了，**则不能出栈释放**。（谓之：闭包）

# 闭包
* 垃圾回收机制导致的

>闭包：函数执行产生一个私有的上下文，保护内部的私有变量不受污染「保护」  

>外界普遍认为闭包：函数执行产生一个不被释放的私有的上下文，这样不仅保护里面的私有变量不受污染，而且还可以把这些信息存储下来「**保护+保存**」

>闭包是一种机制，不要局限于具体的代码，供其 _下级_ 上下文使用。

